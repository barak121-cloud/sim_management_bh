// Supabase Client Configuration
// Uses environment variables for security

const SUPABASE_URL = typeof import.meta !== 'undefined' && import.meta.env 
  ? import.meta.env.VITE_SUPABASE_URL 
  : window.SUPABASE_URL || '';

const SUPABASE_ANON_KEY = typeof import.meta !== 'undefined' && import.meta.env 
  ? import.meta.env.VITE_SUPABASE_ANON_KEY 
  : window.SUPABASE_ANON_KEY || '';

// For development without Vite, you can set these in a script tag before loading this file:
// <script>window.SUPABASE_URL = 'your-url'; window.SUPABASE_ANON_KEY = 'your-key';</script>

let supabase = null;

async function initSupabase() {
  if (supabase) return supabase;
  
  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
    console.warn('Supabase credentials not configured. Using localStorage fallback.');
    return null;
  }
  
  // Load Supabase from CDN if not using Vite
  if (typeof window.supabase === 'undefined') {
    await loadSupabaseScript();
  }
  
  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  return supabase;
}

function loadSupabaseScript() {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

function getSupabase() {
  return supabase;
}

export { initSupabase, getSupabase, SUPABASE_URL, SUPABASE_ANON_KEY };
